<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>POS</title>
    <link rel="stylesheet" href="../../../../Assets/Frameworks/bootstrap-5.2.1-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../../Assets/fonts/css/all.min.css">
    <meta name="viewport" content="width=device-width initial-scale=1 maximum-scale=1 minimum-scale=1 user-scalable=no">
</head>
<body>
<!--Nav bar-->
<nav class="navbar navbar-expand-lg bg-light">
    <div class="container-fluid g-5">
        <h3 class="navbar-brand" href="#">Uresha Stores</h3>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Order</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Item</a>
                </li>

            </ul>
            <li class="nav-item fa-pull-right d-flex ">
                <a class="nav-link active col " aria-current="page" href="#"><i class="fa-solid fa-user-plus"></i>Login</a>
            </li>
            <li class="nav-item fa-pull-right d-flex ">
                <a class="nav-link active col " aria-current="page" href="#"><i class="fa-solid fa-arrow-right-from-bracket"></i>Log out</a>
            </li>
        </div>
    </div>
</nav>
<!--Item header-->
<section class="d-flex justify-content-center">
    <div class="card w-75 bg-opacity-25">
        <h5 class="card-header bg-success "><i class="fa-solid fa-users"></i></i>Customer</h5>
        <div class="card-body">
            <!--Devider-->
            <h8 class="card-title"><nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Customer</li>
                </ol>
            </nav></h8>
            <!--Search Item-->
            <div class="row">
            <div class="card col-lg-6 col-lg-4 col-md-8" >
                <div class="card-header bg-success">
                    Search Customer
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><nav class="navbar bg-light">
                        <div class="container-fluid">
                            <form class="d-flex" role="search">
                                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                                <button class="btn btn-outline-warning" type="submit">Search</button>
                                <div class="dropdown">
                                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        Name
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#">Action</a></li>
                                        <li><a class="dropdown-item" href="#">Another action</a></li>
                                        <li><a class="dropdown-item" href="#">Something else here</a></li>
                                    </ul>
                                </div>
                            </form>
                        </div>
                    </nav></li>
                </ul>
            </div>
            </div>
            <!--ADD NEW BUTTONS-->
            <div class="row justify-content-end">
            <div class="btn-group col align-self-end col-xs-12 col-md-4 col-lg-5 col-xl-5 " role="group" aria-label="Basic mixed styles example">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" >Add new Customer</button>
                <button type="button" class="btn btn-warning " id="btnviewAll">View All Customer</button>
            </div>
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-success bg-opacity-50">
                                <h5 class="modal-title" id="exampleModalLabel">Customer</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="mb-3">
                                        <label for="Cus-ID" class="col-form-label">Customer Id</label>
                                        <input type="text" class="form-control" id="Cus-ID">
                                        <span class="control-error" id="CusIdLbl"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="Cus-Nme" class="col-form-label">Customer Name:</label>
                                        <input type="text" class="form-control" id="Cus-Nme">
                                        <span class="control-error" id="CusNmeLbl"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="Cus-add" class="col-form-label">Customer Address</label>
                                        <input type="text" class="form-control" id="Cus-add">
                                        <span class="control-error" id="CusAddLbl"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label for="Cus-cntct" class="col-form-label">Customer Contact</label>
                                        <input type="text" class="form-control" id="Cus-cntct">
                                        <span class="control-error" id="CusCntctLbl"></span>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer fa-pull-right">
                                <button type="button" class="btn btn-danger" id="AddCusSve" disabled>Save</button>
                                <button type="button" class="btn btn-warning" id="Renew">Renew</button>
                                <button type="button" class="btn btn-info" data-bs-dismiss="modal">Close</button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
            <div class="btn-group col-xs-12 col-sm-12 col-md-4" role="group" aria-label="Basic mixed styles example">
                <button type="button" class="btn btn-danger" id="btnDlte">Delete</button>
                <button type="button" class="btn btn-info">Details</button>
                <button type="button" class="btn btn-success">Clear</button>
            </div>
            </div>
            <!--Table-->

            <table class="table">
                <thead class="bg-success">
                <tr class="table-primary">
                    <th scope="col">Customer ID</th>
                    <th scope="col">Name</th>
                    <th scope="col">Address</th>
                    <th scope="col">Contact</th>
                </tr>
                </thead>
                <tbody id="cusTbl">
                    <tr>

                    </tr>
                </tbody>
            </table>

        </div>
    </div>
    </div>
</section>

<script src="../../../../Assets/Frameworks/bootstrap-5.2.1-dist/js/bootstrap.min.js"></script>
<script src="../../../../Assets/JS/jquery-3.6.1.min.js"> </script>
<script>

    

    var customers=[];

    $("#AddCusSve").click(function () {
       let CusId = $("#Cus-ID").val();
        let CusNme = $("#Cus-Nme").val();
       let CusAdd = $("#Cus-add").val();
       let CusCnt = $("#Cus-cntct").val();

    var customerObject = {
           id:CusId,
           name:CusNme,
        Address:CusAdd,
        Contact:CusCnt
    }
    customers.push(customerObject);
        loadAll();
    });

    $("#btnviewAll").click(function () {
        loadAll();
    });
    $("#btnDlte").click(function () {
       let dlteId = $("#Cus-ID").val();
       DeleteCustomer(dlteId);
    })
    $("#Renew").click(function () {
        let customerID = $("#Cus-ID").val();
        let response = updateCustomer(customerID);
        if (response) {
            alert("Customer Updated Successfully");
            setTextfieldValues("", "", "", "");
        } else {
            alert("Update Failed..!");

        }
    });

    function loadAll() {
        $("#cusTbl").empty();
        for (var customer of customers){
            var row = "<tr> <td>"+customer.id+"</td> <td>"+customer.name+"</td> <td>"+customer.Address+"</td> <td>"+customer.Contact+"</td> </tr>"
            $("#cusTbl").append(row);
        }

    }
    $("#cusTbl>tr").click(function () {
        let id = $(this).children(":eq(0)").text();
        let name = $(this).children(":eq(1)").text();
        let Address = $(this).children(":eq(2)").text();
        let contact = $(this).children(":eq(3)").text();

        $('#Cus-ID').val(id);
        $('#Cus-Nme').val(name);
        $('#Cus-add').val(Address);
        $('#Cus-cntct').val(contact);
    });

    $("#Cus-ID").on('keydown', function (event) {
        if (event.key == "Enter"){
            $("#Cus-Nme").focus();
        }
    });
    $("#Cus-Nme").on('keydown', function (event) {
        if (event.key == "Enter"){
            $("#Cus-add").focus();
        }
    });
    $("#Cus-add").on('keydown', function (event) {
        if (event.key == "Enter"){
            $("#Cus-cntct").focus();
        }
    });

    $("#Cus-ID").focus();
    const CusIDRegEx = /^(C00-)[0-9]{1,3}$/;
    const CusNmeRegEx = /^[A-z]{5,15}$/;
    const CusAddRegEx = /^[0-9/A-z. ,]{7,}$/;
    const cusCntctRegEx =/[0-9+]{10,15}$/;

    let cusValidation = [];
    cusValidation.push({reg:CusIDRegEx, filed:$('#Cus-ID'),error:'Enter Correct Custemer Id Pattern : C00-001'});
    cusValidation.push({reg:CusNmeRegEx, filed:$('#Cus-Nme'),error:'Enter Correct Custemer Name Pattern : Pradeep kumara'});
    cusValidation.push({reg:CusAddRegEx, filed:$('#Cus-add'),error:'Enter Correct Custemer Address Pattern : No 32,Kaluthara Rd,Mathugama'});
    cusValidation.push({reg:cusCntctRegEx, filed:$('#Cus-cntct'),error:'Enter Correct Custemer contact Pattern : 0342244144'});

    $("#Cus-ID,#Cus-Nme,#Cus-add,#Cus-cntct").on('keydown',function (event) {
        checkValidity();
    });
    $("#Cus-ID,#Cus-Nme,#Cus-add,#Cus-cntct").on('keyup',function (event) {
        checkValidity();
    });
    $("#Cus-ID,#Cus-Nme,#Cus-add,#Cus-cntct").on('blur',function (event) {
        checkValidity();
    });
    $("#Cus-ID").on('keydown',function (event) {
        if (event.key =="Enter" && check(CusIDRegEx,$("#Cus-ID"))){
            $("#Cus-Nme").focus();
        }else {
            focusText($("#Cus-ID"))
        }
    });
    $("#Cus-Nme").on('keydown', function (event) {
        if (event.key == "Enter" && check(CusNmeRegEx, $("#Cus-Nme"))) {
            focusText($("#Cus-add"));
        }
    });
    $("#Cus-add").on('keydown', function (event) {
        if (event.key == "Enter" && check(CusAddRegEx, $("#Cus-add"))) {
            focusText($("#Cus-cntct"));
        }
    });
    $("#Cus-cntct").on('keydown', function (event) {
        if (event.key == "Enter" && check(cusCntctRegEx, $("#Cus-cntct"))) {
            let res = confirm("Do you want to add this customer.?");
            if (res) {
                clearAllTexts();
            }
        }
    });


    function checkValidity() {
        let errorCount=0;
        for (let validation of cusValidation) {
            if (check(validation.reg,validation.filed)){
                textSuccess(validation.filed,"");
            }else {
                errorCount=errorCount+1;
                setTextError(validation.filed,validation.error);
            }
        }
        setButtonState(errorCount);
    }
    function check(regex, txtField) {
        let inputValue = txtField.val();
        return regex.test(inputValue) ? true : false;
    }
    function setTextError(txtField,error) {
        if (txtField.val().length <= 0) {
            defaultText(txtField,"");
        } else {
            txtField.css('border', '2px solid red');
            txtField.parent().children('span').text(error);
        }
    }

    function textSuccess(txtField,error) {
        if (txtField.val().length <= 0) {
            defaultText(txtField,"");
        } else {
            txtField.css('border', '2px solid green');
            txtField.parent().children('span').text(error);
        }
    }

    function defaultText(txtField,error) {
        txtField.css("border", "1px solid #ced4da");
        txtField.parent().children('span').text(error);
    }

    function focusText(txtField) {
        txtField.focus();
    }

    function setButtonState(value){
        if (value>0){
            $("#AddCusSve").attr('disabled',true);
        }else{
            $("#AddCusSve").attr('disabled',false);
        }
    }

    function clearAllTexts() {
        $("#Cus-ID").focus();
        $("#Cus-ID,#Cus-Nme,#Cus-add,#Cus-cntct").val("");
        checkValidity();
    }


    $("#Cus-ID").on('keydown', function (event) {
        if (event.code == "Enter") {
            let srchId = $("#Cus-ID").val();
            let customer = searchCustomer(srchId)
            if (customer !=null){
                $("#Cus-ID").val(customer.id);
                $("#Cus-Nme").val(customer.name);
                $("#Cus-add").val(customer.Address);
                $("#Cus-cntct").val(customer.Contact);
            }else {
                alert("Can t find given Id");
            }

        }
    })

    function searchCustomer(cusID) {
        for (let customer of customers) {
            if(customer.id == cusID){
                return customer;
            }
        }
        return null;
    }
    function DeleteCustomer(CusId) {
        let customer = searchCustomer(CusId);
        if (customer !=null){
           let indexNumber = customers.indexOf(customer);
           customers.splice(indexNumber,1);
           loadAll();
        }
    }
    function updateCustomer(customerID) {
        let customer = searchCustomer(customerID);
        if (customer != null) {
            customer.id = $("#Cus-ID").val();
            customer.name = $("#Cus-Nme").val();
            customer.address = $("#Cus-add").val();
            customer.salary = $("#Cus-cntct").val();
            loadAll();
            return true;
        } else {
            return false;
        }

    }
    function setTextfieldValues(id, name, Address, Contact) {
        $("#Cus-ID").val(id);
        $("#Cus-Nme").val(name);
        $("#Cus-add").val(Address);
        $("#Cus-cntct").val(Contact);
    }
</script>
</body>
</html>